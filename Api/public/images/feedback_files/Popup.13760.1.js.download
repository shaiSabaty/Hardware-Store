/*GgewenFramework Translate Function@From Biz.Common.Popup.init();@New require('Biz.Common.Popup')(containers);*/NEG.Module("Biz.Common.Popup", function (require) {var $ = require("NEG.ThirdParty.jQuery");var maskBuilder = require('NEG.Widget.Mask');var resourceManager = require("Biz.UI.ResourceManager");var popup = function (containers, option) {var me = arguments.callee;if (!(this instanceof me)) {return new me(containers, option);}var viewPort = {top: function () {return window.pageYOffset|| document.documentElement && document.documentElement.scrollTop|| document.body.scrollTop;},height: function () {return window.innerHeight|| document.documentElement && document.documentElement.clientHeight|| document.body.clientHeight;},left: function () {return window.pageXOffset|| document.documentElement && document.documentElement.scrollLeft|| document.body.scrollLeft;},width: function () {return window.innerWidth|| document.documentElement && document.documentElement.clientWidth|| document.body.clientWidth;},right: function () {return this.left() + this.width();},bottom: function () {return this.top() + this.height();}};var _options = {width: 400,height: 200,header: true,custom: false,followCursor: false};_options = NEG.merge(_options, option);var width = _options.width,height = _options.height,header = _options.header,custom = _options.custom;var iconMapping = {'warning': "atnIcon icnInfoNew",'info': "atnIcon icnInfo",'info661': "atnIcon661 icnInfo661"};var noneGif = resourceManager.Image.build("none.gif");var headerTitle = "<span class='title'></span>";var headerClose = "<a class='atnIcon icnCloseNew close '  href='javascript:void(0);' style='width:auto;'><img src='" + noneGif + "' alt='close window'></a>";var contentHeader = "<span id='AlarmPanelNew'><img class='iconNew' alt='' src='" + noneGif + "'>" +headerTitle + "</span>" +headerClose;var contentBody ="<div id='modal1' class='v660' style='display:none' data-popup-contentbody='true'><div class='neg-popup-header'>" +contentHeader +"</div><div class='content popUpLink' ></div>" +"<div class='footer'><a class='close' href='javascript:void(0);'>close window</a></div>" +"</div>";var $contentBody = $(contentBody);var customBody = "<div id='custom' style='display:none' data-popup-custombody='true'></div>";var $customBody = $(customBody);/*if (!$('body').attr('data-popup-contentbody')) {$('body').append($contentBody);}*/if ($('[data-popup-contentbody]').length <= 0) {$('body').append($contentBody);} else {$contentBody = $('[data-popup-contentbody]');}if ($('[data-popup-custombody]').length <= 0) {$('body').append($customBody);} else {$customBody = $('[data-popup-custombody]');}var maskWindow = maskBuilder({ target: window.document }, {style: { "z-index": " 99998" },supportResize: true});maskWindow.on('BEFORE_HIDE', function () {if (custom) {$customBody.hide('fast');} else {$contentBody.hide('fast');}});$(containers).map(function (index, dom) {if (!$(dom).attr('data-popup-loaded')) {NEG(dom).on('click', function () {var $this = $(this);if (_options.dataProcess) {return _options.dataProcess($this, show);}if (custom) {customShow($this, _options.followCursor);$(window).resize(function () {if (jQuery(document).width() <= 1100) {return;}var curPopup = jQuery("div.is-current");var left = viewPort.right() - curPopup.width() - $this.width() - $this.width() + "px";if (viewPort.right() - $this.offset().left > $customBody.width()) {left = $this.offset().left - 20;}if (!_options.followCursor) {left = (jQuery(document.body).width() - $customBody.width()) / 2}var bottomHeight = jQuery(window).height() - ($this.offset().top - jQuery(window).scrollTop());var arrowBottom = false;if (bottomHeight < $customBody.height() && $customBody.height() < ($this.offset().top + 10 - jQuery(document).scrollTop())) {arrowBottom = true;}var top = jQuery(curPopup).offset().top - jQuery(window).scrollTop();var topLeft = curPopup.find(".centerPopup-arrow");if (_options.followCursor) {if (arrowBottom) {top = $this.offset().top - 10 - $customBody.height();jQuery(topLeft).attr("class", "").attr("class", "centerPopup-arrow docked-bottom-left");} else {top = $this.offset().top + $this.height() + 10 + "px";jQuery(topLeft).attr("class", "").attr("class", "centerPopup-arrow docked-top-left");}}curPopup.css({'left': left,'top': top});if (topLeft && _options.followCursor) {topLeft.css({'left': $this.offset().left -curPopup.offset().left - 4});}});if (_options.followCursor) {$(window).scroll(function () {var curPopup = jQuery("div.is-current");var top = $this.offset().top + $this.height() + 10 + "px";var bottomHeight = jQuery(window).height() -($this.offset().top - jQuery(window).scrollTop());var arrowBottom = false;if (bottomHeight < jQuery(curPopup).height() &&jQuery(curPopup).height() < ($this.offset().top + 10)) {arrowBottom = true;top = $this.offset().top - 10 - jQuery(curPopup).height();}curPopup.css({'top': top});var topLeft = curPopup.find(".centerPopup-arrow");if (arrowBottom) {jQuery(topLeft).attr("class", "").attr("class", "centerPopup-arrow docked-bottom-left");} else {jQuery(topLeft).attr("class", "").attr("class", "centerPopup-arrow docked-top-left");}});}} else {show($this);}});}});var show = function ($this) {var id = $this.attr('data-neg-popid'),$content = $("div[data-neg-popid='" + id + "_content']"),$title = $("div[data-neg-title='" + id + "_title']");var elementPosition = $this.offset();var pX = Math.min(elementPosition.left + $this.width(), viewPort.right() - width);var pY = Math.min(elementPosition.top, viewPort.bottom() - height);if (header) {var iconClass = iconMapping[_options.icon];if (_options.hideIcon) {$contentBody.find("#AlarmPanelNew").css('display', 'none');} else {$contentBody.find("#AlarmPanelNew").css('display', 'block');}$contentBody.find(".neg-popup-header>span").removeClass();$contentBody.find(".neg-popup-header>span").addClass(iconClass);$contentBody.find(".neg-popup-header").css('display', 'block');} else {$contentBody.find(".neg-popup-header").css('display', 'none');}$contentBody.css({"left": pX + 'px',"top": pY + 'px'});_options.beforeShow && _options.beforeShow($content, $this);maskWindow.show();$contentBody.find('.title').html($title.html() ? $title.html() : '');$contentBody.children('.content').html($content.html());$contentBody.show('fast');_options.afterShow && _options.afterShow($content, $this);$(maskWindow.dom).one('click', function () {maskWindow.hide();});$contentBody.find('.close').on('click', function () {maskWindow.hide();});};var customShow = function ($this, followPoint) {var id = $this.attr('data-neg-custom-popid');var popclass = $this.attr("popclass");var $content = $("div[data-neg-custom-popid='" + id + "_content']");$customBody.removeClass();$customBody.html($content.html());var left, top;if (!String.isNullOrEmpty(popclass)) {$customBody.addClass(popclass);} else {$customBody.addClass(id);}if (!!followPoint) {var elementPosition = $this.offset();left = viewPort.right() - $customBody.width() - $this.width() - $this.width() + "px";if (viewPort.right() - $this.offset().left > $customBody.width()) {left = $this.offset().left - 20;}top = elementPosition.top + $this.height() + 10 + "px";var bottomHeight = jQuery(window).height() - ($this.offset().top - jQuery(window).scrollTop());var arrowBottom = false;if (bottomHeight < $customBody.height() && $customBody.height() < ($this.offset().top + 10 - jQuery(document).scrollTop())) {arrowBottom = true;top = $this.offset().top - 10 - $customBody.height();}var topLeft = $customBody.find(".centerPopup-arrow");if (arrowBottom) {jQuery(topLeft).attr("class", "").attr("class", "centerPopup-arrow docked-bottom-left");} else {jQuery(topLeft).attr("class", "").attr("class", "centerPopup-arrow docked-top-left");}$customBody.css({'left': left,'top': top,'width': "auto",'height': "auto"});} else {left = (jQuery('body').width() - $customBody.width()) / 2,top = (jQuery(window).height() - $customBody.height()) / 2;top = top < 0 ? 0 : top;$customBody.css({'left': left,'top': top});}maskWindow.show();$customBody.show('fast');$customBody.find('.button-decline').on('click', function () {maskWindow.hide();});var topLeft = $customBody.find(".centerPopup-arrow");if (topLeft && followPoint) {topLeft.css({'left': $this.offset().left - $customBody.offset().left - 4});}};$(containers).attr('data-popup-loaded', true);var close = function () {maskWindow.hide();};return NEG.merge(this, {close: close});};return popup;});